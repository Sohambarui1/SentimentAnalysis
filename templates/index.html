<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Mental Health Screening System</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
    --primary:#3f51b5;
    --primary-dark:#2f3fa0;
    --bg:#f4f6fb;
    --card:#ffffff;
    --text:#333;
    --muted:#666;
    --success:#4caf50;
    --warning:#ff9800;
    --danger:#f44336;
    --border:#e0e0e0;
}

*{ 
    box-sizing:border-box; 
    font-family:"Segoe UI", system-ui, -apple-system, sans-serif;
    margin:0;
    padding:0;
}

body{
    background:linear-gradient(135deg, #f5f7ff 0%, #eef1ff 100%);
    min-height:100vh;
    color:var(--text);
    line-height:1.6;
}

.container{
    max-width:1000px;
    margin:0 auto;
    padding:20px;
}

header{
    background:linear-gradient(135deg, var(--primary), #5c6bc0);
    color:white;
    padding:2rem;
    border-radius:20px;
    text-align:center;
    margin-bottom:2rem;
    box-shadow:0 10px 30px rgba(63, 81, 181, 0.2);
    position:relative;
    overflow:hidden;
}

header::before{
    content:"";
    position:absolute;
    top:-50%;
    left:-50%;
    width:200%;
    height:200%;
    background:radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
    background-size:50px 50px;
    opacity:0.3;
}

header h1{
    font-size:2.2rem;
    margin-bottom:0.5rem;
    font-weight:600;
}

header p{
    opacity:0.9;
    font-size:1rem;
    max-width:600px;
    margin:0 auto;
}

.subtitle{
    display:flex;
    align-items:center;
    justify-content:center;
    gap:10px;
    margin-top:10px;
    font-size:0.9rem;
    opacity:0.8;
}

.card{
    background:var(--card);
    border-radius:18px;
    padding:2rem;
    box-shadow:0 8px 30px rgba(0,0,0,0.08);
    margin-bottom:2rem;
    border:1px solid var(--border);
    transition:transform 0.3s ease, box-shadow 0.3s ease;
    position:relative;
    min-height:400px;
}

.card:hover{
    transform:translateY(-5px);
    box-shadow:0 15px 40px rgba(0,0,0,0.12);
}

.card h3{
    color:var(--primary);
    margin-bottom:1rem;
    font-size:1.4rem;
    display:flex;
    align-items:center;
    gap:10px;
}

.card h3 i{
    font-size:1.2rem;
}

.input-group{
    margin-bottom:1.5rem;
}

textarea{
    width:100%;
    min-height:180px;
    padding:1.2rem;
    border-radius:12px;
    border:2px solid var(--border);
    font-size:1rem;
    resize:vertical;
    transition:all 0.3s ease;
    line-height:1.5;
    font-family:inherit;
}

textarea:focus{
    outline:none;
    border-color:var(--primary);
    box-shadow:0 0 0 3px rgba(63, 81, 181, 0.1);
}

.samples{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    margin-top:1rem;
}

.sample-btn{
    padding:8px 16px;
    background:#e8eaf6;
    border:none;
    border-radius:20px;
    cursor:pointer;
    font-size:0.85rem;
    color:var(--primary);
    transition:all 0.2s ease;
}

.sample-btn:hover{
    background:#d1d9ff;
    transform:translateY(-2px);
}

.btn{
    display:inline-flex;
    align-items:center;
    gap:10px;
    padding:1rem 2rem;
    background:linear-gradient(135deg, var(--primary), var(--primary-dark));
    color:white;
    border:none;
    border-radius:50px;
    cursor:pointer;
    font-size:1rem;
    font-weight:600;
    transition:all 0.3s ease;
    box-shadow:0 5px 15px rgba(63, 81, 181, 0.3);
    position:relative;
    overflow:hidden;
}

.btn:hover{
    transform:translateY(-3px);
    box-shadow:0 8px 20px rgba(63, 81, 181, 0.4);
}

.btn:active{
    transform:translateY(-1px);
}

.btn:disabled {
    opacity: 0.7;
    cursor: not-allowed;
    transform: none !important;
}


/* FIXED LOADING ANIMATION */
.processing {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 18px;
    z-index: 10;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.4s ease, visibility 0.4s ease;
}

.processing.active {
    opacity: 1;
    visibility: visible;
}

.processing-content {
    text-align: center;
    max-width: 400px;
    padding: 2rem;
}

.loading-spinner {
    width: 80px;
    height: 80px;
    margin: 0 auto 2rem;
    position: relative;
}

.loading-spinner::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    border: 4px solid transparent;
    border-top-color: var(--primary);
    border-right-color: var(--primary);
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.loading-spinner i {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 2rem;
    color: var(--primary);
    animation: pulse 1.5s ease-in-out infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 0.7; transform: translate(-50%, -50%) scale(1); }
    50% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
}

.processing-text {
    margin-top: 1rem;
}

.processing-text h4 {
    color: var(--primary);
    margin-bottom: 0.5rem;
    font-size: 1.2rem;
}

.processing-steps {
    margin-top: 1.5rem;
    text-align: left;
}

.processing-step {
    display: flex;
    align-items: center;
    margin-bottom: 0.8rem;
    font-size: 0.9rem;
    color: var(--muted);
    opacity: 0.8;
    animation: fadeInStep 0.5s ease forwards;
}

.processing-step.completed {
    color: var(--success);
    opacity: 1;
}

.processing-step.active {
    color: var(--primary);
    opacity: 1;
    font-weight: 600;
}

.processing-step i {
    margin-right: 10px;
    font-size: 1rem;
}

.processing-step .step-check {
    color: var(--success);
    display: none;
}

.processing-step.completed .step-check {
    display: inline-block;
}

.processing-step.completed .step-spinner {
    display: none;
}

@keyframes fadeInStep {
    from {
        opacity: 0;
        transform: translateX(-10px);
    }
    to {
        opacity: 0.8;
        transform: translateX(0);
    }
}

/* Fixed result section */
.result{
    display:none;
    animation:fadeIn 0.5s ease;
}

@keyframes fadeIn{
    from{ opacity:0; transform:translateY(20px); }
    to{ opacity:1; transform:translateY(0); }
}

.result-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    flex-wrap:wrap;
    gap:2rem;
    margin-bottom:2rem;
    padding-bottom:1.5rem;
    border-bottom:2px solid var(--border);
}

.sentiment-box{
    display:flex;
    align-items:center;
    gap:1.5rem;
    flex-wrap:wrap;
}

.sentiment-circle{
    width:100px;
    height:100px;
    border-radius:50%;
    color:white;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    font-size:1.8rem;
    font-weight:bold;
    box-shadow:0 8px 20px rgba(0,0,0,0.15);
}

.sentiment-circle small{
    font-size:0.9rem;
    opacity:0.9;
    margin-top:5px;
}

.positive{ background:linear-gradient(135deg, var(--success), #2e7d32); }
.neutral{ background:linear-gradient(135deg, var(--warning), #ef6c00); }
.negative{ background:linear-gradient(135deg, var(--danger), #c62828); }

.info-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));
    gap:1.5rem;
    margin:2rem 0;
}

.info-box{
    background:#f8f9ff;
    padding:1.5rem;
    border-radius:12px;
    border-left:5px solid var(--primary);
}

.info-box span{
    display:block;
    font-size:0.85rem;
    color:var(--muted);
    margin-bottom:0.5rem;
    text-transform:uppercase;
    letter-spacing:1px;
}

.info-box strong{
    font-size:1.2rem;
    color:var(--text);
}

.risk-high{ border-left-color:var(--danger); }
.risk-medium{ border-left-color:var(--warning); }
.risk-low{ border-left-color:var(--success); }

.chart-wrapper {
    position: relative;
    width: 100%;
    height: 320px;
    margin: 0 auto;
}

.chart-container canvas {
    display: block;
    max-width: 100%;
}

.stats{
    display:flex;
    justify-content:space-around;
    flex-wrap:wrap;
    gap:1rem;
    margin:1.5rem 0;
    text-align:center;
}

.stat-item{
    flex:1;
    min-width:150px;
    padding:15px;
}

.stat-value{
    font-size:2rem;
    font-weight:bold;
    color:var(--primary);
    margin-bottom:5px;
}

.stat-label{
    font-size:0.85rem;
    color:var(--muted);
    margin-bottom:10px;
    display:block;
}

.confidence-bar {
    width: 100%;
    height: 8px;
    background: #e0e0e0;
    border-radius: 4px;
    overflow: hidden;
    margin-top: 8px;
}

.confidence-fill {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, #4caf50, #81c784);
    border-radius: 4px;
    transition: width 1s ease-out;
}

.recommendation-box{
    background:linear-gradient(135deg, #e8f5e9, #f1f8e9);
    padding:1.5rem;
    border-radius:12px;
    border-left:5px solid var(--success);
    margin-top:2rem;
}

.recommendation-box h4{
    color:#2e7d32;
    margin-bottom:1rem;
    display:flex;
    align-items:center;
    gap:10px;
}

.disclaimer{
    text-align:center;
    padding:1.5rem;
    margin-top:3rem;
    background:#fff8e1;
    border-radius:12px;
    border:2px dashed #ffd54f;
    font-size:0.85rem;
    color:#5d4037;
}

.footer-links{
    display:flex;
    justify-content:center;
    gap:2rem;
    margin-top:2rem;
    flex-wrap:wrap;
}

.footer-link{
    color:var(--primary);
    text-decoration:none;
    font-size:0.9rem;
}

.footer-link:hover{
    text-decoration:underline;
}

@media (max-width:768px){
    .container{
        padding:1rem;
    }
    
    header{
        padding:1.5rem;
    }
    
    header h1{
        font-size:1.8rem;
    }
    
    .result-header{
        flex-direction:column;
        align-items:flex-start;
    }
    
    .sentiment-circle{
        width:80px;
        height:80px;
        font-size:1.4rem;
    }
    
    .stat-item{
        min-width:120px;
    }
    
    .processing-content {
        padding: 1rem;
    }
    
    .loading-spinner {
        width: 60px;
        height: 60px;
        margin-bottom: 1.5rem;
    }
}
</style>
</head>

<body>

<div class="container">

<header>
    <h1><i class="fas fa-brain"></i> AI Mental Health Screening System</h1>
    <p>Text-based mental health risk assessment using real-world data and machine learning</p>
    <div class="subtitle">
        <i class="fas fa-shield-alt"></i> Secure • Anonymous • Research-Based
    </div>
</header>

<div class="card">
    <div class="input-section">
        <h3><i class="fas fa-edit"></i> Input Text for Analysis</h3>
        <p style="color:var(--muted); margin-bottom:1.5rem;">
            Enter a description of your thoughts, feelings, or mood. The system will analyze it for mental health indicators.
        </p>
        
        <div class="input-group">
            <textarea id="userText" placeholder="Example: I've been feeling extremely anxious lately, having trouble sleeping, and find it hard to concentrate on my work. I feel overwhelmed most days..."></textarea>
            
            <div class="samples">
                <div style="font-size:0.9rem; color:var(--muted); margin-right:10px;">Try sample:</div>
                <button class="sample-btn" onclick="setSample(0)">Anxiety Example</button>
                <button class="sample-btn" onclick="setSample(1)">Depression Example</button>
                <button class="sample-btn" onclick="setSample(2)">Stress Example</button>
                <button class="sample-btn" onclick="setSample(3)">Positive Example</button>
            </div>
        </div>
        
                <button class="btn" onclick="analyze()" id="analyzeBtn">
            <i class="fas fa-chart-line"></i> Analyze Text
        </button>
    
    </div>
    
    <!-- FIXED LOADING ANIMATION -->
    <div class="processing" id="processing">
        <div class="processing-content">
            <div class="loading-spinner">
                <i class="fas fa-brain"></i>
            </div>
            
            <div class="processing-text">
                <h4>Analyzing Your Text</h4>
                <p>Please wait while we process your input...</p>
            </div>
            
            <div class="processing-steps">
                <div class="processing-step" id="step1">
                    <i class="fas fa-spinner fa-spin step-spinner"></i>
                    <i class="fas fa-check step-check"></i>
                    Processing text sentiment
                </div>
                <div class="processing-step" id="step2">
                    <i class="fas fa-spinner fa-spin step-spinner"></i>
                    <i class="fas fa-check step-check"></i>
                    Extracting keywords
                </div>
                <div class="processing-step" id="step3">
                    <i class="fas fa-spinner fa-spin step-spinner"></i>
                    <i class="fas fa-check step-check"></i>
                    Evaluating mental health indicators
                </div>
                <div class="processing-step" id="step4">
                    <i class="fas fa-spinner fa-spin step-spinner"></i>
                    <i class="fas fa-check step-check"></i>
                    Generating recommendations
                </div>
            </div>
        </div>
    </div>
</div>

<div class="card result" id="resultBox">
    <div class="result-header">
        <div>
            <h3><i class="fas fa-clipboard-check"></i> Analysis Results</h3>
            <p id="time" style="color:var(--muted);"></p>
        </div>
        
        <div class="sentiment-box">
            <div id="sentimentCircle" class="sentiment-circle">
                <div id="sentimentScore">0</div>
                <small>Score</small>
            </div>
            <div>
                <strong id="sentimentLabel"></strong>
                <div style="font-size:0.9rem; color:var(--muted);">
                    <i class="fas fa-smile"></i> Emotional Sentiment
                </div>
            </div>
        </div>
    </div>
    
    <div class="stats">
        <div class="stat-item">
            <div class="stat-value" id="confidenceScore">0%</div>
            <div class="stat-label">Model Confidence</div>
            <!-- Confidence Bar -->
            <div class="confidence-bar">
                <div class="confidence-fill" id="confidenceFill"></div>
            </div>
        </div>
        
        <div class="stat-item">
            <div class="stat-value" id="wordCount">0</div>
            <div class="stat-label">Words Analyzed</div>
        </div>
        
        <div class="stat-item">
            <div class="stat-value" id="riskValue">0%</div>
            <div class="stat-label">Risk Score</div>
        </div>
    </div>
    
    <div class="info-grid">
        <div class="info-box" id="categoryBox">
            <span><i class="fas fa-tag"></i> Mental Health Category</span>
            <strong id="category"></strong>
        </div>
        <div class="info-box" id="riskBox">
            <span><i class="fas fa-exclamation-triangle"></i> Risk Level</span>
            <strong id="risk"></strong>
        </div>
    </div>
    
    <div class="chart-container">
        <h4><i class="fas fa-chart-bar"></i> Risk Level Visualization</h4>
        <div class="chart-wrapper">
            <canvas id="riskChart"></canvas>
        </div>
    </div>
    
    <div class="recommendation-box">
        <h4><i class="fas fa-hands-helping"></i> Personalized Recommendations</h4>
        <p id="recommendation"></p>
    </div>
</div>

<div class="disclaimer">
    <p><strong>⚠️ Important Disclaimer:</strong></p>
    <p>This system is an AI-powered screening tool for educational and research purposes only. It does NOT provide medical diagnosis, treatment, or crisis intervention. If you are experiencing a mental health emergency, please contact emergency services or a crisis helpline immediately.</p>
    <p>Always consult qualified healthcare professionals for medical advice.</p>
</div>

<div class="footer-links">
    <a href="#" class="footer-link"><i class="fas fa-lock"></i> Privacy Policy</a>
    <a href="#" class="footer-link"><i class="fas fa-book"></i> Research Basis</a>
    <a href="#" class="footer-link"><i class="fas fa-phone-alt"></i> Crisis Resources</a>
    <a href="#" class="footer-link"><i class="fas fa-info-circle"></i> About This Project</a>
</div>

</div>

<script>
// Sample texts for testing
const samples = [
    "I've been feeling extremely anxious lately, having trouble sleeping, and find it hard to concentrate on my work. I feel overwhelmed most days and sometimes have panic attacks.",
    "For the past few weeks, I've lost interest in activities I used to enjoy. I feel sad all the time, have no energy, and sometimes think that life isn't worth living anymore.",
    "Work has been incredibly stressful with tight deadlines. I'm having trouble relaxing even after work hours, and I'm irritable with my family. My sleep quality has decreased significantly.",
    "I feel generally positive about life. I have good relationships, enjoy my work, and practice mindfulness regularly. Some days are challenging, but I have healthy coping mechanisms."
];

// Mock data for different conditions
const mockResults = {
    0: { // Anxiety
        sentiment_label: "Negative",
        sentiment_score: -0.8,
        confidence: 87.5,
        category: "Anxiety Disorder",
        risk: "High Risk",
        probabilities: {
            "Anxiety": 75,
            "Depression": 15,
            "Stress": 8,
            "Well-being": 2
        },
        recommendation: "Consider speaking with a mental health professional about anxiety management techniques. Practice deep breathing exercises, mindfulness meditation, and establish a consistent sleep routine. Consider limiting caffeine intake and practice gradual exposure to anxiety-provoking situations."
    },
    1: { // Depression
        sentiment_label: "Very Negative",
        sentiment_score: -0.95,
        confidence: 92.3,
        category: "Major Depression",
        risk: "High Risk",
        probabilities: {
            "Depression": 85,
            "Anxiety": 10,
            "Stress": 4,
            "Well-being": 1
        },
        recommendation: "Please seek professional help immediately. Depression is treatable with therapy and/or medication. Reach out to a mental health professional, trusted friend, or family member. Consider contacting a crisis helpline if you're having thoughts of self-harm."
    },
    2: { // Stress
        sentiment_label: "Negative",
        sentiment_score: -0.7,
        confidence: 78.9,
        category: "Chronic Stress",
        risk: "Medium Risk",
        probabilities: {
            "Stress": 65,
            "Anxiety": 25,
            "Depression": 8,
            "Well-being": 2
        },
        recommendation: "Implement stress management strategies such as regular exercise, time management techniques, and setting healthy boundaries at work. Consider mindfulness practices, taking regular breaks, and ensuring adequate sleep. Delegate tasks when possible and practice saying 'no' to excessive demands."
    },
    3: { // Positive
        sentiment_label: "Positive",
        sentiment_score: 0.85,
        confidence: 88.2,
        category: "Good Mental Health",
        risk: "Low Risk",
        probabilities: {
            "Well-being": 80,
            "Stress": 12,
            "Anxiety": 5,
            "Depression": 3
        },
        recommendation: "Continue your positive mental health practices. Maintain your mindfulness routine, nurture your relationships, and continue engaging in activities you enjoy. Consider sharing your coping strategies with others who may benefit."
    }
};

let chart = null;
let currentSampleIndex = 0;
let processingTimeout = null;

function setSample(index) {
    document.getElementById('userText').value = samples[index];
    currentSampleIndex = index;
}

function showProcessing() {
    const processingEl = document.getElementById('processing');
    const analyzeBtn = document.getElementById('analyzeBtn');
    
    // Reset all steps
    for (let i = 1; i <= 4; i++) {
        const step = document.getElementById('step' + i);
        step.classList.remove('completed', 'active');
        step.querySelector('.step-spinner').style.display = 'inline-block';
        step.querySelector('.step-check').style.display = 'none';
    }
    
    // Show processing overlay
    processingEl.classList.add('active');
    analyzeBtn.disabled = true;
    analyzeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
    
    // Animate steps one by one
    animateProcessingSteps();
}

function animateProcessingSteps() {
    let currentStep = 0;
    const totalSteps = 4;
    
    function nextStep() {
        if (currentStep > 0) {
            const prevStep = document.getElementById('step' + currentStep);
            prevStep.classList.remove('active');
            prevStep.classList.add('completed');
            prevStep.querySelector('.step-spinner').style.display = 'none';
            prevStep.querySelector('.step-check').style.display = 'inline-block';
        }
        
        currentStep++;
        
        if (currentStep <= totalSteps) {
            const currentStepEl = document.getElementById('step' + currentStep);
            currentStepEl.classList.add('active');
            
            // Random delay between steps (400-800ms)
            const delay = 400 + Math.random() * 400;
            setTimeout(nextStep, delay);
        }
    }
    
    // Start animation
    setTimeout(nextStep, 300);
}

function hideProcessing() {
    const processingEl = document.getElementById('processing');
    const analyzeBtn = document.getElementById('analyzeBtn');
    
    processingEl.classList.remove('active');
    analyzeBtn.disabled = false;
    analyzeBtn.innerHTML = '<i class="fas fa-chart-line"></i> Analyze Text';
    
    // Clear any existing timeout
    if (processingTimeout) {
        clearTimeout(processingTimeout);
        processingTimeout = null;
    }
}

// Generate mock analysis based on text content
function mockAnalyze(text) {
    const textLower = text.toLowerCase();
    
    if (textLower.includes('anxious') || textLower.includes('panic') || textLower.includes('overwhelmed')) {
        return mockResults[0];
    } else if (textLower.includes('sad') || textLower.includes('no energy') || textLower.includes('life isn\'t worth')) {
        return mockResults[1];
    } else if (textLower.includes('stress') || textLower.includes('deadlines') || textLower.includes('irritable')) {
        return mockResults[2];
    } else if (textLower.includes('positive') || textLower.includes('good') || textLower.includes('enjoy')) {
        return mockResults[3];
    } else {
        return {
            sentiment_label: "Neutral",
            sentiment_score: 0.1,
            confidence: 65.5,
            category: "General Assessment",
            risk: "Low Risk",
            probabilities: {
                "Well-being": 45,
                "Stress": 30,
                "Anxiety": 15,
                "Depression": 10
            },
            recommendation: "Your text shows mixed emotional indicators. Consider maintaining a mood journal to track patterns, and if concerns persist, consult with a mental health professional for personalized guidance."
        };
    }
}


function analyze() {
    const text = document.getElementById('userText').value.trim();
    if (!text || text.length < 10) {
        alert("Please enter at least 10 characters.");
        return;
    }

    showProcessing();

    // Try to call real API, fallback to mock if server not available
    fetch("/analyze", {
        method: "POST",
        headers: { 
            "Content-Type": "application/json"
        },
        body: JSON.stringify({ text: text })
    })
    .then(res => {
        if (!res.ok) {
            // If server error, use mock data
            console.log("Server not responding, using mock analysis");
            throw new Error('Server not available');
        }
        return res.json();
    })
    .then(data => {
        hideProcessing();
        if (data.error) {
            alert("Error: " + data.error);
            return;
        }
        showResult(data);
    })
    .catch(err => {
        // Fallback to mock analysis
        console.log("Using mock analysis:", err.message);
        hideProcessing();
        
        // Use mock analysis based on current sample
        const mockData = mockAnalyze(text);
        showResult(mockData);
        
    });
}

// Update the showResult function to properly handle all risk levels
function showResult(data) {
    // Show result section
    const resultBox = document.getElementById('resultBox');
    resultBox.style.display = 'block';
    
    // Smooth scroll to results
    setTimeout(() => {
        resultBox.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }, 100);

    // Time
    document.getElementById('time').innerHTML =
        `<i class="far fa-clock"></i> Analyzed: ${new Date().toLocaleString()}`;

    // ===== SENTIMENT =====
    const sentimentLabel = data.sentiment_label || "Neutral";
    const sentimentScore = data.sentiment_score || 0;

    document.getElementById('sentimentScore').textContent = sentimentScore.toFixed(2);
    document.getElementById('sentimentLabel').textContent = sentimentLabel;

    const sentimentCircle = document.getElementById('sentimentCircle');
    sentimentCircle.className = 'sentiment-circle';
    
    if (sentimentScore > 0.3) {
        sentimentCircle.classList.add('positive');
    } else if (sentimentScore < -0.3) {
        sentimentCircle.classList.add('negative');
    } else {
        sentimentCircle.classList.add('neutral');
    }

        // ===== CATEGORY & RISK =====
    document.getElementById('category').textContent = data.category || "Not Available";
    
    const riskText = data.risk || "Low";
    document.getElementById('risk').textContent = riskText;

    // Color-code risk box with all possible risk levels
    const riskBox = document.getElementById('riskBox');
    riskBox.className = 'info-box';
    
    const riskLower = riskText.toLowerCase();
    
    if (riskLower.includes('critical')) {
        riskBox.classList.add('risk-high');
    } 
    else if (riskLower.includes('high')) {
        riskBox.classList.add('risk-high');
    }
    else if (riskLower.includes('medium')) {
        riskBox.classList.add('risk-medium');
    } 
    else {
        // Default to low if unknown
        riskBox.classList.add('risk-low');
    }

    // ===== CONFIDENCE =====
    let confidence = data.confidence || 0;
    if (confidence > 100) confidence = 100;
    if (confidence < 0) confidence = 0;
    
    document.getElementById('confidenceScore').textContent = confidence.toFixed(1) + '%';
    
    // Animate confidence bar
    setTimeout(() => {
        const confidenceFill = document.getElementById('confidenceFill');
        confidenceFill.style.width = confidence + '%';
        
        // Color based on confidence level
        if (confidence >= 80) {
            confidenceFill.style.background = 'linear-gradient(90deg, #4caf50, #66bb6a)';
        } else if (confidence >= 60) {
            confidenceFill.style.background = 'linear-gradient(90deg, #ff9800, #ffb74d)';
        } else {
            confidenceFill.style.background = 'linear-gradient(90deg, #f44336, #e57373)';
        }
    }, 100);

    // ===== WORD COUNT =====
    const wordCount = document.getElementById('userText').value.trim().split(/\s+/).length;
    document.getElementById('wordCount').textContent = wordCount;

        // ===== RISK VALUE =====
    const riskValue = document.getElementById('riskValue');
    let riskPercent = 25;
    
    if (riskLower.includes('critical')) {
        riskPercent = 95;
        riskValue.style.color = '#d32f2f';
    } else if (riskLower.includes('high')) {
        riskPercent = 85;
        riskValue.style.color = '#f44336';
    } else if (riskLower.includes('medium')) {
        riskPercent = 55;
        riskValue.style.color = '#ff9800';
    } else if (riskLower.includes('low')) {
        riskPercent = 25;
        riskValue.style.color = '#4caf50';
    } else {
        // Default
        riskPercent = 25;
        riskValue.style.color = '#4caf50';
    }
    
    riskValue.textContent = riskPercent + "%";

    // ===== RECOMMENDATION =====
    document.getElementById('recommendation').textContent = 
        data.recommendation || "No recommendation available.";

    // ===== CHART =====
    drawChart(data.probabilities || {});
}

function drawChart(probabilities) {
    const ctx = document.getElementById("riskChart").getContext("2d");

    if (chart) {
        chart.destroy();
    }

    // Ensure probabilities is an object with values
    if (!probabilities || Object.keys(probabilities).length === 0) {
        probabilities = { "Normal": 100 };
    }

    // Filter and normalize probabilities
    const entries = Object.entries(probabilities)
        .filter(([_, v]) => typeof v === "number" && v > 0);

    // If no valid entries, show a default chart
    if (entries.length === 0) {
        entries.push(["No Data", 100]);
    }

    const labels = entries.map(e => e[0]);
    const values = entries.map(e => e[1]);

    // Normalize to 100% for pie chart
    const total = values.reduce((a, b) => a + b, 0);
    const normalized = values.map(v => (v / total) * 100);

    // Define colors for each condition
    const colorMap = {
        "Normal": "#4caf50",
        "Well-being": "#4caf50",
        "Wellbeing": "#4caf50",
        "Depression": "#9c27b0",
        "Anxiety": "#ff9800",
        "Stress": "#2196f3",
        "Suicidal": "#f44336",
        "Bipolar": "#ff5722",
        "Personality_disorder": "#795548",
        "Personality Disorder": "#795548",
        "PTSD": "#607d8b",
        "No Data": "#9e9e9e"
    };

    const colors = labels.map(label => colorMap[label] || "#607d8b");

    try {
        chart = new Chart(ctx, {
            type: "doughnut",
            data: {
                labels: labels,
                datasets: [{
                    data: normalized,
                    backgroundColor: colors,
                    borderWidth: 2,
                    borderColor: "#ffffff",
                    hoverOffset: 15
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: "65%",
                plugins: {
                    legend: { 
                        position: "bottom",
                        labels: {
                            padding: 20,
                            font: {
                                size: 11
                            },
                            color: "#333"
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const label = context.label || '';
                                const value = context.parsed || 0;
                                return `${label}: ${value.toFixed(1)}%`;
                            }
                        }
                    }
                },
                animation: {
                    animateScale: true,
                    animateRotate: true
                }
            }
        });
    } catch (error) {
        console.error("Chart error:", error);
        // Create a simple text display if chart fails
        ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
        ctx.fillStyle = "#333";
        ctx.font = "16px Arial";
        ctx.textAlign = "center";
        ctx.fillText("Chart Data:", ctx.canvas.width/2, ctx.canvas.height/2 - 20);
        ctx.font = "14px Arial";
        labels.forEach((label, i) => {
            ctx.fillText(`${label}: ${normalized[i].toFixed(1)}%`, ctx.canvas.width/2, ctx.canvas.height/2 + (i * 20));
        });
    }
}

// Initialize with first sample
window.onload = function() {
    setSample(0);
};
</script>

</body>
</html>